import"../core/Root.es.js";import"../UI.es.js";class h{static instance=null;static handleAnchor=i=>{if(typeof i=="string"){i.includes("#")&&(i=i.split("#").at(-1)),document.getElementById(i).scrollIntoView({behavior:"smooth"});return}i.onClick(e=>{e.preventDefault(),document.getElementById(i.html.href.split("#")[1]).scrollIntoView({behavior:"smooth"})})};constructor(i){if(h.instance!=null){console.error("A Router has already been instantiated!"),delete this;return}h.instance=this,window.addEventListener("popstate",e=>{e.state==null&&this.autoRoute()}),this.routes=[],this.currentRoute=null,this.currentPath="",this.basePath="",this.defaultRoute="/",this.main=i}createRoute(i,e){i=this.basePath+i;const t=this.routes.find(r=>r.matchesPath(i));t&&this.routes.splice(this.routes.indexOf(t)),this.routes.push(new c(i,e,this)),this.routes.at(-1).main=this.main}async setRoute(i){i=this.basePath+i;const e=this.routes.find(t=>t.matchesPath(i));if(e){const t=new URL(window.location.href);t.pathname=i,await e.activate(t)}else console.error("Route not found: "+i)}async autoRoute(){const i=window.location.pathname.replace(this.basePath,""),e=new URL(window.location.href);if(e.hash!=""){this.currentPath==i||await this.setRoute(i),h.handleAnchor(e.hash);return}this.routes.find(r=>r.matchesPath(i))!=null||await this.setRoute(this.defaultPath),await this.setRoute(i)}}class c{constructor(i,e,t){this.path=i.trim(),this.pathStructure=this.generatePathStructure(),this.createElems=e,this.elems=[],this.router=t,this.param={},this.query={}}generatePathStructure(){const i=[],e=this.path.split("/");for(const t of e)t!=""&&i.push({value:t,isStatic:!t.startsWith(":")});return i}matchesPath(i){const e=i.trim().split("/");for(let t=0;t<e.length;t++){const r=e[t];r==""&&(e.splice(e.indexOf(r),1),t--)}if(e.length==0&&this.pathStructure.length==0)return!0;if(e.length!=this.pathStructure.length)return!1;for(let t=0;t<e.length;t++)if(e[t]!=this.pathStructure[t].value&&this.pathStructure[t].isStatic)return!1;return!0}activate=async i=>{for(let a=0;a<this.main.children.length;a++)this.main.children[a].preserveOnRerender||(this.main.removeChild(a),a--);const e=i.pathname.split("/");for(const a of e)a==""&&e.splice(e.indexOf(""),1);let t="";for(const a of e)t+="/"+a;for(let a=0;a<e;a++)t=t.replace(s.value,e[a]);const n=window.location.href.split("/").slice(0,3).join("/");history.pushState(null,null,n+t),this.router.currentPath=t,this.router.currentRoute=this,this.getPathParams(i.pathname);const o=await this.createElems(this.router);for(const a of o)this.main.append(a)};getPathParams(i){const e=i.split("/");for(const t of e)t==""&&e.splice(e.indexOf(""),1);for(let t=0;t<this.pathStructure.length;t++){const r=this.pathStructure[t];r.isStatic||(this.param[r.value.replace(":","")]=e[t])}}}export{c as Route,h as Router};
//# sourceMappingURL=Router.es.js.map
